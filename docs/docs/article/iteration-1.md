# –ò—Ç–µ—Ä–∞—Ü–∏—è 1: DSL-–æ–±—ë—Ä—Ç–∫–∞ `testCase`, `step`, `attach`

## üéØ –¶–µ–ª—å

–°–¥–µ–ª–∞—Ç—å API-—Ç–µ—Å—Ç —á–∏—Ç–∞–µ–º—ã–º, –ª–æ–≥–∏—á–µ—Å–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏ –≥–æ—Ç–æ–≤—ã–º –∫ –∑–∞–≥—Ä—É–∑–∫–µ –≤ Allure TestOps ‚Äî –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é –ø–∏—Å–∞—Ç—å `allure.label(...)`, `allure.step(...)` –∏ –¥—Ä—É–≥–∏–µ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –≤—ã–∑–æ–≤—ã.

---

## ü§Ø –ü—Ä–æ–±–ª–µ–º–∞

`allure-vitest` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞—Å–∞–¥—É Allure (–º–µ—Ç–∫–∏, —à–∞–≥–∏, –≤–ª–æ–∂–µ–Ω–∏—è), –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º API –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º –∏ –¥—É–±–ª–∏—Ä—É–µ–º—ã–º:

```ts
import * as allure from 'allure-js-commons'

test('profile', async () => {
  await allure.label('AS_ID', 'API-123')
  await allure.feature('Profile')
  await allure.step('GET /profile', async () => {
    const res = await axios.get('/profile')
    await allure.attachment('response', JSON.stringify(res.data), 'application/json')
    expect(res.status).toBe(200)
  })
})
```

- üîÅ –ü–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –≤—ã–∑–æ–≤—ã
- ‚ö†Ô∏è –õ—ë–≥–∫–æ –æ—à–∏–±–∏—Ç—å—Å—è –≤ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∫–ª—é—á–∞—Ö (`AS_ID`, `severity`)
- üìâ –°–Ω–∏–∂–∞–µ—Ç—Å—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ —Ç–µ–º–ø —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ ‚Äî –æ–±—ë—Ä—Ç–∫–∞

–°–æ–∑–¥–∞—ë–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π DSL: `testCase`, `step`, `attach`  
‚Üí –µ–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å, —á–∏—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –º–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫.

```ts
testCase(
  '–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è',
  { id: 'API-101', feature: '–ü—Ä–æ—Ñ–∏–ª—å', severity: 'critical' },
  async () => {
    const response = await step('GET /profile', () => axios.get('/profile'))
    attach('–û—Ç–≤–µ—Ç', response.data, 'application/json')
    expect(response.status).toBe(200)
  }
)
```

> –ö–æ—Ä–æ—Ç–∫–æ, –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ, –∫—Ä–∞—Å–∏–≤–æ. –í—Å—ë –Ω—É–∂–Ω–æ–µ ‚Äî –Ω–∞ –≤–∏–¥—É.

---

## üîß –ß—Ç–æ –º—ã —Å–¥–µ–ª–∞–ª–∏

- ‚úçÔ∏è –ù–∞–ø–∏—Å–∞–ª–∏ `testCase(name, meta, fn)` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- üìö –û–±–µ—Ä–Ω—É–ª–∏ —à–∞–≥–∏ –≤ `step(name, fn)`
- üìé –î–æ–±–∞–≤–∏–ª–∏ `attach(name, content)` —Å –∞–≤—Ç–æ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π

---

## üí° –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ

- –£–¥–∞–ª—è–µ—Ç boilerplate (`label`, `step`, `attachment`)
- –ü–æ–≤—ã—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –æ—Ç—á—ë—Ç–∞—Ö
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä—É–µ—Ç —Å—Ç–∏–ª—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
- –ó–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã: –∫–ª–∞—Å—Å—ã, –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã, —Å–ª–æ–∏

---

## ‚öôÔ∏è –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º

```ts
import * as allure from 'allure-js-commons'
import { test } from 'vitest'

export function testCase(name, meta, fn) {
  test(name, async () => {
    if (meta.id) await allure.label('AS_ID', meta.id)
    if (meta.feature) await allure.feature(meta.feature)
    if (meta.severity) await allure.severity(meta.severity)
    await fn()
  })
}

export async function step(name, fn) {
  return await allure.step(name, fn)
}

export function attach(name, data, type = 'text/plain') {
  allure.attachment(name, typeof data === 'string' ? data : JSON.stringify(data), type)
}
```

---

## üìà –ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ

- ‚úÖ –¢–µ—Å—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á–∏—Ç–∞–µ–º –∫–∞–∫ **—Å—Ü–µ–Ω–∞—Ä–∏–π**
- ‚úÖ –°–æ–∫—Ä–∞—â–∞–µ—Ç—Å—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ü–æ–≤—ã—à–∞–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è
- ‚úÖ –£–º–µ–Ω—å—à–∞–µ—Ç—Å—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—à–∏–±–æ–∫ (`label('AS_ID', ...)` ‚Üí —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)
- ‚úÖ –ü–æ–≤—ã—à–∞–µ—Ç—Å—è –∫–∞—á–µ—Å—Ç–≤–æ Allure-–æ—Ç—á—ë—Ç–æ–≤
- ‚úÖ –ì–æ—Ç–æ–≤–∞ –ø–æ—á–≤–∞ –¥–ª—è class-based –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

---

## üß© –ò—Ç–æ–≥–∏ –ò—Ç–µ—Ä–∞—Ü–∏–∏ 1: —á–∏—Ç–∞–µ–º—ã–µ —Ç–µ—Å—Ç—ã, –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —è–∑—ã–∫ –Ω–∞–º–µ—Ä–µ–Ω–∏–π

–ü–µ—Ä–≤–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –¥–∞–ª–∞ –Ω–∞–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω—ã–π DSL (`testCase`, `step`, `attach`) –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è API-—Ç–µ—Å—Ç–æ–≤.  
–ò –≤—Ä–æ–¥–µ –±—ã ‚Äî –≤—Å–µ–≥–æ —Ç—Ä–∏ –æ–±—ë—Ä—Ç–∫–∏. –ù–æ –æ–Ω–∏ –∏–∑–º–µ–Ω–∏–ª–∏ –≤—Å—ë.

### üí° –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –º—ã —Å–¥–µ–ª–∞–ª–∏?

- –£–ø–∞–∫–æ–≤–∞–ª–∏ –≤—ã–∑–æ–≤—ã —Ñ–∞—Å–∞–¥–∞ –≤ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π `testCase()`
- –î–æ–±–∞–≤–∏–ª–∏ —á–∏—Ç–∞–µ–º—É—é –æ–±—ë—Ä—Ç–∫—É `step()` —Å –ª–æ–≥–∏–∫–æ–π –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è
- –°–¥–µ–ª–∞–ª–∏ `attach()` –±–µ–∑–æ–ø–∞—Å–Ω—ã–º, —Å –∞–≤—Ç–æ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π JSON
- –î–æ–±–∞–≤–∏–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É `allureId`, `feature`, `severity`

```ts
testCase(
  '–ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è',
  { id: 'API-101', feature: '–ü—Ä–æ—Ñ–∏–ª—å', severity: 'critical' },
  async () => {
    const response = await step('GET /profile', () => axios.get(...))
    attach('–û—Ç–≤–µ—Ç', response.data, 'application/json')
    expect(response.status).toBe(200)
  }
)
```

---

### üß† –ö–∞–∫ —ç—Ç–æ –Ω–∞–∑–≤–∞—Ç—å?

–ú—ã –±–æ–ª—å—à–µ –Ω–µ –ø–∏—à–µ–º ‚Äú—Ç–µ—Å—Ç-—Ñ—É–Ω–∫—Ü–∏—é‚Äù. –ú—ã –æ–ø–∏—Å—ã–≤–∞–µ–º **—Ç–µ—Å—Ç-–∫–µ–π—Å**.

- –≠—Ç–æ –Ω–µ `unit test`, —ç—Ç–æ `use-case`
- –≠—Ç–æ –Ω–µ `test(name, () => {})`, —ç—Ç–æ `testCase(meta, steps)`
- –≠—Ç–æ –Ω–µ ‚Äú–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏‚Äù, —ç—Ç–æ ‚Äú–ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-—Å—Ü–µ–Ω–∞—Ä–∏—è‚Äù

üìå –≠—Ç–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–∏–∂–µ –∫:

| –¢–µ—Ä–º–∏–Ω                  | –ü–æ–¥—Ö–æ–¥–∏—Ç? | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                          |
|-------------------------|-----------|--------------------------------------|
| Scenario-based testing  | ‚úÖ        | –µ—Å—Ç—å —à–∞–≥–∏, —Å—Ü–µ–Ω–∞—Ä–∏–∏, feature         |
| Use-case testing        | ‚úÖ        | –∫–∞–∂–¥—ã–π `testCase` ‚Äî —ç—Ç–æ use-case     |
| Structured test DSL     | ‚úÖ        | —É –Ω–∞—Å —Å–≤–æ–π —è–∑—ã–∫ –æ–ø–∏—Å–∞–Ω–∏—è             |
| Classic unit testing    | ‚ùå        | —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ                |

---

## üîú –ß—Ç–æ –¥–∞–ª—å—à–µ

–í —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –º—ã –ø—Ä–µ–≤—Ä–∞—Ç–∏–º —Ç–µ—Å—Ç—ã –≤ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã —Å `@TestCase`, `@Feature`, `@Severity` –∏ –µ–¥–∏–Ω—ã–º `runTestClass()`.

–¢–∞–∫ –º—ã —Å–¥–µ–ª–∞–µ–º –µ—â—ë –æ–¥–∏–Ω —à–∞–≥ –æ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî –∫ **—Ç–µ—Å—Ç—É –∫–∞–∫ —Å—Ü–µ–Ω–∞—Ä–∏—é**.

---

üìé –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –ª–µ–≥–∫–æ –ø–æ–¥—É–º–∞—Ç—å:
> ‚Äú–≠—Ç–æ –ø—Ä–æ—Å—Ç–æ –æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ vitest –∏ allure, –¥–∞?‚Äù

–ù–æ –Ω–µ—Ç. –ú—ã –∑–∞–∫–ª–∞–¥—ã–≤–∞–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É. –ò —ç—Ç–æ –≤–∞–∂–Ω–æ.

---
